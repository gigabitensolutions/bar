<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b1220"/>
  <title>Comandas ‚Äî Bar</title>
  <link rel="stylesheet" href="./assets/app.css"/>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row">
        <h1>üçª Comandas</h1>
        <div class="right row">
          <span id="dbStatus" class="tag">DB: ‚Äî</span>
          <button id="bigTouchBtn" class="btn ghost" aria-pressed="false">Toque grande</button>
          <button id="overviewBtn" class="btn">Vis√£o geral</button>
          <button id="historyBtn" class="btn">Hist√≥rico</button>
          <select id="comandaSelect" class="select" style="min-width:160px"></select>
          <button id="deleteComandaBtn" class="btn danger">Excluir</button>
        </div>
      </div>

      <!-- Nova comanda (inline) -->
      <div class="row" style="margin-top:8px;flex-wrap:wrap;gap:10px">
        <div class="input" style="flex:1;max-width:240px;padding:0">
          <input id="ncName" class="input" placeholder="Nome da comanda (ex.: Mesa 1)" style="border:none;width:100%;background:transparent" />
        </div>
        <div class="input" style="flex:1;max-width:200px;padding:0">
          <input id="ncLabel" class="input" placeholder="Etiqueta (opcional)" style="border:none;width:100%;background:transparent" />
        </div>
        <div id="ncColors" class="swatches" aria-label="Cores" style="align-items:center"></div>
        <button id="ncAdd" class="btn accent">Nova</button>
      </div>

      <!-- Filtros por categoria -->
      <div id="chips" class="chips" style="margin-top:6px"></div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="input" style="display:flex;gap:6px;align-items:center">
          <input id="search" class="input" placeholder="Buscar produto..." style="flex:1"/>
          <button id="clearSearch" class="btn">Limpar</button>
        </div>
        <div></div>
        <div></div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <!-- Bottom bar -->
  <div class="bar">
    <div class="bar-inner">
      <div><strong id="summaryCount">0 itens</strong></div>
      <div class="price" id="summaryTotal">R$ 0,00</div>
      <button id="openDrawer" class="btn accent">Ver comanda</button>
    </div>
  </div>

  <!-- Drawer da comanda -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>
          <div id="comandaNameMini" style="font-weight:800;font-size:18px">‚Äî</div>
          <div id="comandaLabelMini" class="mini">‚Äî</div>
        </div>
        <button id="closeDrawer" class="btn">Fechar</button>
      </div>

      <div id="lines" style="margin-top:8px"></div>

      <div class="totals">
        <div class="line"><span>Subtotal</span><strong id="subtotalTxt">R$ 0,00</strong></div>
        <div class="line"><span>Servi√ßo (10%)</span><strong id="serviceTxt">R$ 0,00</strong></div>
        <div class="line"><span>Total</span><strong id="totalTxt">R$ 0,00</strong></div>
      </div>

      <div class="row" style="margin-top:8px;gap:10px;flex-wrap:wrap">
        <label class="switch"><input id="sv10" type="checkbox"/> Cobrar servi√ßo 10%</label>
        <div id="payMethods" class="chips" style="padding:0"></div>
      </div>

      <div class="actions">
        <button id="shareBtn" class="btn">Compartilhar</button>
        <button id="pdfBtn" class="btn">Gerar PDF</button>
        <button id="print80Btn" class="btn">Imprimir (80mm)</button>
        <button id="clearItemsBtn" class="btn warn">Limpar</button>
        <button id="closeComandaBtn" class="btn danger">Fechar comanda</button>
        <button id="pixBtn" class="btn accent">PIX (QR)</button>
      </div>
    </div>
  </div>

  <!-- Modal: Vis√£o geral -->
  <div id="overviewModal" class="modal" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true">
      <h3>Vis√£o geral</h3>
      <div id="board"></div>
      <div class="row" style="margin-top:12px">
        <button id="closeOverviewBtn" class="btn">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Hist√≥rico (agora com Exportar PDF) -->
  <div id="historyModal" class="modal" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true">
      <h3>Hist√≥rico</h3>

      <div class="row" style="gap:8px;margin:6px 0 10px">
        <button id="histExportPdfBtn" class="btn">Exportar PDF</button>
        <span class="mini">Gera relat√≥rio com tudo que foi consumido</span>
      </div>

      <div id="histList" class="hist-list"></div>
      <div class="row" style="margin-top:12px">
        <button id="closeHistoryBtn" class="btn">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Modal: PIX -->
  <div id="pixModal" class="modal" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true">
      <h3>PIX ‚Äî C√≥digo copia e cola</h3>
      <div id="pixQR" style="display:flex;justify-content:center;margin:6px 0 10px"></div>
      <input id="pixPayload" class="input" readonly value=""/>
      <div class="row" style="margin-top:8px">
        <button id="copyPixBtn" class="btn">Copiar c√≥digo</button>
        <button id="closePixBtn" class="btn">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Canvas oculto para gerar dataURL do QR -->
  <div id="qrHidden" style="position:absolute;left:-9999px;top:-9999px"></div>

  <!-- Scripts -->
  <script src="./assets/firebase-config.js"></script>
  <script src="./assets/db.firebase.js"></script>
  <!-- jsPDF para PDF do Hist√≥rico e da comanda -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-NaWenYyq2+G2Jc3qYVQvLx3i7GAYeR4a1TNUC7m8g4bW0P4b8n0A7kHq1cF7i3fZq6b5chYzhuEo8pKkq2R3WQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- QRCodeJS para gerar QR do PIX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgI0d3n9fQt6kYY3QbT1v7mH7hHjV3a9qf1p1lq4A1q1yqFZxC6y2sJ3FfMVmciZr2VvYJk1NVr7W3VDI9h7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="./assets/pos.js"></script>
</body>
</html>